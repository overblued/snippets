<!DOCTYPE html>
<!--
	a codepen like testing tool for ideas or tring out new feature
	want to see how flexable the flexbox is
	@overblued
-->
<html>
	<head>
	<style>
		html, body { height: 100%; }
		body { margin: 0; }
		
		/* flex */
		/* container */
		.flex-container	{ display:   flex; }
		.flex-row 		{ flex-flow: row wrap; }
		.flex-column	{ flex-flow: column wrap;}
		.flex-center	{
			/* these were default for stretch */
			justify-content: center;
			align-content:	 center;
		}
		/* item */
		.flex-container > * { flex: 100 1 1px; }
		.order-1 { order: 1; }
		.order-2 { order: 2; }
		.order-3 { order: 3; }
		
		#main {
			height: 100%;
			background-color: #e6e6fa;
		}
		
		.box-show {
			/* this allow .event-mask to work*/
			position: relative;
			padding: 2px;
			box-shadow: inset 0 0 2px black;
		}
		.box-show > iframe {
			border: none;
			background-color: white;
		}
		/* this prevent iframe from absorbing it's parent node's events*/
		.event-mask{
			position: absolute;
			height:   100%;
			width:    100%;
			background-color: transparent;
		}
		
		.box-edit {  }
		.box-edit > div.textarea {
			padding:  3px;
			overflow: auto;
			font: 0.8em Consolas, Monospace;
			box-shadow: inset 0 0 3px black;
			background-color: white;
			transition: flex-grow 0.3s;
		}
		.box-edit > div.textarea:focus { flex-grow: 200; }
		/* give each editable box a unique inscription */
		.box-edit > .css { background-image: url("data: image/svg+xml;utf8, <svg xmlns='http://www.w3.org/2000/svg' version='1.1' height='100%' width='100%'><text x='50%' y='50%'  text-anchor='middle' alignment-baseline='middle' fill='#fee' font-size='60'>CSS</text></svg>");}
		.box-edit > .js { background-image: url("data: image/svg+xml;utf8, <svg xmlns='http://www.w3.org/2000/svg' version='1.1' height='100%' width='100%'><text x='50%' y='50%' text-anchor='middle' alignment-baseline='middle' fill='#efe' font-size='60'>JS</text></svg>");}
		.box-edit > .html { background-image: url("data: image/svg+xml;utf8, <svg xmlns='http://www.w3.org/2000/svg' version='1.1' height='100%' width='100%'><text x='50%' y='50%' text-anchor='middle' alignment-baseline='middle' fill='#eef' font-size='60'>HTML</text></svg>");}
		
		.box-resize {
			flex: 0 1 5px;
			cursor: col-resize;
		} 
		.box-resize > span {
			margin: auto;
			width:	1px;
			height:	1px;
			background-color: #999;
		}
		
		/* etc */
		.hidden{ display: none; }

	</style>
	<script>
		(function(){
			//this manage how code are showed inside iframe
			function editor(css,js,html,iframe){
				this.css = css;
				this.js = js;
				this.html = html;
				this.load();
				this.iframeDoc = iframe.contentWindow.document;
				this.update();
			}
			editor.prototype = {
				update: function () {
					var cssLinks = '';
					var css = this.getRaw(this.css).replace(/<link.+?>/g,function(m){cssLinks += m;return '';});
					
					var html = "<html><head>" + cssLinks + "<style>"+ css +"</style><script>"+this.getRaw(this.js)+"<" + "/script></head><body>" + this.getRaw(this.html) + "</body></html>";
					this.iframeDoc.open();
					this.iframeDoc.write(html);
					this.iframeDoc.close();
					this.save();
				},
				save: function () {
					try {
						localStorage.setItem('css',this.css.html());
						localStorage.setItem('js',this.js.html());
						localStorage.setItem('html',this.html.html());
					} catch (e){
						console.log('unable to access localStorage');
					}
					
				},
				load: function (){
					try {
						this.css.html(localStorage.getItem('css'));
						this.js.html(localStorage.getItem('js'));
						this.html.html(localStorage.getItem('html'));
					} catch (e){
						console.log('unable to access localStorage');
					}
				},
				getRaw: function (elem) {
					return elem.text().replace(/\s*([{}: ;,])\s*/g,'$1');
				},
				deco: function (text) {
					return text.replace(/&lt;div &lt;\/div&gt;/);
				}
			};
			
			function Layout() {
				
			}
			Layout.prototype = {
			
			};
			//helpers
			function intVal(n,l,h){
				return Math.min(Math.max(n,l),h);
			}
			//main
			addEventListener('load',function(){
				var edit = new editor($('.box-edit>.css'),$('.box-edit>.js'),$('.box-edit>.html'),$('.box-show>iframe')[0]);
				addEventListener('keydown',function (e) {
					//manually press F2 to make code taking effect
					if (e.keyCode == 113){	
						edit.update();
					}
				});
				
				(function () {
				//add the ability to rescale the size of 2 window
				//start
				var scalePercentage = (function () {
					var $left = $('.box-show'),
						$right = $('.box-edit');
					return function (x){
						x = 2 * intVal(x, 10, 90);
						$left.css('flexGrow', x);
						$right.css('flexGrow', 200 - x);
					}
				})();
				function onmove(e) {
					var ratio = Math.round(100 * e.pageX / document.body.clientWidth);
					scalePercentage(ratio);
				}
				
				var $mask = $('.event-mask');
				var $body = $(document.body);
				$('.box-resize').on('mousedown',function (e) {
					//show mask
					if ($mask.hasClass('hidden')){
						e.preventDefault();
						$mask.toggleClass('hidden');
						$body.on('mousemove',onmove);
						$body.css('cursor','col-resize');
					}
				});
				$body.on('mouseup',function (e) {
					//remove mask
					if (!$mask.hasClass('hidden')){
						e.preventDefault();
						$mask.toggleClass('hidden');
						$body.off('mousemove',onmove);
						$body.css('cursor','auto');
					}
				});
				//end
				})();
			//main end
			});
		})();
	</script>
	</head>
	<body>
		<div id="main" class="flex-container flex-row">
			<div class="box-show flex-container order-1">
				<div class="event-mask hidden"></div>
				<iframe></iframe>
			</div>
			<div class="box-resize flex-container flex-column order-2">
				<span></span>
			</div>
			<div class="box-edit flex-container flex-column order-3">
				<div contenteditable class="textarea css order-1"></div>
				<div contenteditable class="textarea js order-3"></div>
				<div contenteditable class="textarea html order-2"></div>
			</div>
		</div>
		<script src="http://cdn.bootcss.com/jquery/2.1.3/jquery.min.js"></script>
	</body>
</html>