<!--
	a codepen like testing tool for ideas or tring out new feature
	want to see how flexable the flexbox is
	@overblued
-->
<!doctype html>
<html>
	<head>
	<style>
		*{box-sizing:border-box;}
		html,body{
			margin:0;
			height:100%;
			width:100%;
		}
		
		/* flex */
		.flex-container {
			display:flex;}
		/* a default for all items in the container */
		.flex-container > * { flex: 100 1 1px; }
		.flex-row { flex-flow: row wrap; }
		.flex-column { flex-flow: column wrap;}
		
		#main{
			background-color:#e6e6fa;
			width:100%;
			height:100%;
			padding:2px;
		}
		.box-show{
			position:relative;
			padding:2px;
			border:none;
			box-shadow:inset 0 0 2px black;	}
		.box-show > iframe {
			border:none;background-color:white;
		}
		
		.box-edit{  }
		.box-edit>div.textarea{
			font:1em Consolas;
			box-shadow:inset 0 0 3px black;
			padding: 3px; border:none;
			transition: flex-grow 0.5s;
			background-color:white;}
		.box-edit>div.textarea:focus{ flex-grow: 200;}
		
		.box-edit > .box-css{ background-image:url("data:image/svg+xml;utf8, <svg xmlns='http://www.w3.org/2000/svg' version='1.1' height='100%' width='100%'><text x='40%' y='50%' fill='#fae6e6' font-size='60'>CSS</text></svg>");}
		.box-edit > .box-js { background-image:url("data:image/svg+xml;utf8, <svg xmlns='http://www.w3.org/2000/svg' version='1.1' height='100%' width='100%'><text x='40%' y='50%' fill='#e6fae6' font-size='60'>JS</text></svg>");}
		.box-edit > .box-html{ background-image:url("data:image/svg+xml;utf8, <svg xmlns='http://www.w3.org/2000/svg' version='1.1' height='100%' width='100%'><text x='40%' y='50%' fill='#e6e6fa' font-size='60'>HTML</text></svg>");}
		
		.box-control {
			cursor:pointer;
			align-self: center;
			flex: 0 1 6px;
			height:40px;
			width:40px;}
		.box-control:hover{
			box-shadow:0 0 5px yellow
		}
		.box-control > span{
			display:block;
			margin-bottom:2px;
			background-color: white;
			box-shadow:inset 0 0 5px black;
			border-radius:50%;
		}
		
		
		/* etc */
		.hidden{ display:none }
		.order-1{ order: 1; }
		.order-2{ order: 2; }
		.order-3{ order: 3; }
		/* this prevent iframe from absorbing it's parent node's events*/
		.event-mask{ height:100%;width:100%;background-color:transparent;position:absolute; }
	</style>
	<script>
		(function(){
			//this manage how code are showed inside iframe
			function editor(css,js,html,iframe){
				this.css = css;
				this.js = js;
				this.html = html;
				this.load();
				this.iframe = iframe;
				this.update();
			}
			
			editor.prototype = {
				update: function () {
					var html = "<html><head><style>"+ this.getRaw(this.css)+"</style><script>"+this.getRaw(this.js)+"<" + "/script></head><body>" + this.getRaw(this.html) + "</body></html>"
					this.iframe.contentWindow.document.open();
					this.iframe.contentWindow.document.write(html);
					this.iframe.contentWindow.document.close();
					this.save();
				},
				save: function () {
					localStorage.setItem('css',this.getRaw(this.css));
					localStorage.setItem('js',this.getRaw(this.js));
					localStorage.setItem('html',this.getRaw(this.html));
				},
				load: function (){
					this.css.textContent = localStorage.getItem('css');
					this.js.textContent = localStorage.getItem('js');
					this.html.textContent = localStorage.getItem('html');
				},
				getRaw: function (elem) {
					return elem.textContent;
				}
			};
			
			//helpers
			function make(str) {
				return document.createElement(str)
			}
			function select(str){
				return document.querySelector(str);
			};
			function switchClass(pattern,elem1,elem2) {
				var c1 = elem1.className,
					c2 = elem2.className;
				if(pattern.test(c1) && pattern.test(c2)){
					var sub1 = c1.match(pattern);
					var sub2 = c2.match(pattern);
					elem1.className = c1.replace(pattern,sub2)
					elem2.className = c2.replace(pattern,sub1)
				}
			}
			
			//main
			addEventListener('load',function(){
				var edit = new editor(select('.box-css'),select('.box-js'),select('.box-html'),select('.box-show>iframe'));
				addEventListener('keydown',function (e) {
					//manually press F2 to make code taking effect
					if (e.keyCode == 113){	
						edit.update();
					}
				});
				
				//add the ability to rescale the size of 2 window
				(function () {
				
				var scalePercentage = (function () {
					var left = select('.box-show');
					var right = select('.box-edit');
					return function (x){
						if (x < 10){ x = 10;}
						if (x > 90) { x = 90;}
						left.style.flexGrow = x*2;
						right.style.flexGrow = 200 - x*2;
					}
				})();
				function onmove(e) {
					var ratio = Math.round(100 * e.pageX / document.body.clientWidth);
					scalePercentage(ratio);
				}
				
				var mask = select('.event-mask');
				var dragging = false;
				select('.box-control').addEventListener('mousedown',function (e) {
					//show mask
					if (!dragging){
						e.preventDefault();
						mask.className = mask.className.replace('hidden','').trim().replace(/ {2,}/g,' ');
						document.body.addEventListener('mousemove',onmove);
						dragging = true;
						select('.box-control').style.flexBasis = '20px';
					}
				});
				document.body.addEventListener('mouseup',function (e) {
					//remove mask
					if (dragging){
					e.preventDefault();
						mask.className = mask.className + ' hidden';
						document.body.removeEventListener('mousemove',onmove);
						dragging = false;
						
						select('.box-control').style.flexBasis = '6px';
					}
					
				});
				})()
		
			});
		})();
	</script>
	</head>
	<body>
		<div id="main" class="flex-container flex-row">
			<div class="box-show flex-container order-1"><div class="event-mask hidden"></div><iframe src="about:blank"></iframe></div>
			<div class="box-control flex-container order-2 flex-column">
				<span></span>
				<span></span>
				<span></span>
			</div>
			<div class="box-edit flex-container flex-column order-3">
				<div contenteditable class="textarea box-css order-1"></div>
				<div contenteditable class="textarea box-js order-3"></div>
				<div contenteditable class="textarea box-html order-2"></div>
			</div>
		</div>
	</body>
</html>